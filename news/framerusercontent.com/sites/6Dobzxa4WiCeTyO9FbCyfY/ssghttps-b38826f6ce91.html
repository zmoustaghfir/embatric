import{getRandom as t,setRangeValue as i,executeOnSingleOrMultiple as e,deepExtend as s,AnimatableColor as n,rangeColorToHsl as o,getRangeValue as a,isPointInside as r,Vector as h,calcPositionOrRandomFromSizeRanged as l,itemFromSingleOrMultiple as d,randomInRange
as c,arrayRandomIndex as u,itemFromArray as m,isInArray as p}from"tsparticles-engine";class CircleShape{randomPosition(i,e,s){const generateTheta=(i,e)=>{const s=t()/4,n=Math.atan(e/i*Math.tan(2*Math.PI*s)),o=t();return o
<.25?n:o<.5?Math.PI-n:o<.75?Math.PI+n:-n},radius=(t,i,e)=>t*i/Math.sqrt((i*Math.cos(e))**2+(t*Math.sin(e))**2),[n,o]=[e.width/2,e.height/2],a=generateTheta(n,o),r=radius(n,o,a),h=s?r*Math.sqrt(t()):r;return{x:i.x+h*Math.cos(a),y:i.y+h*Math.sin(a)}}}class EmitterLife{constructor(){this.wait=false}load(t){if(t){void
    0!==t.count&&(this.count=t.count);void 0!==t.delay&&(this.delay=t.delay);void 0!==t.duration&&(this.duration=t.duration);void 0!==t.wait&&(this.wait=t.wait)}}}class EmitterRate{constructor(){this.quantity=1;this.delay=.1}load(t){if(void 0!==t){void
    0!==t.quantity&&(this.quantity=i(t.quantity));void 0!==t.delay&&(this.delay=i(t.delay))}}}class EmitterSize{constructor(){this.mode="percent";this.height=0;this.width=0}load(t){if(void 0!==t){void 0!==t.mode&&(this.mode=t.mode);void 0!==t.height&&(this.height=t.height);void
    0!==t.width&&(this.width=t.width)}}}class Emitter{constructor(){this.autoPlay=true;this.fill=true;this.life=new EmitterLife;this.rate=new EmitterRate;this.shape="square";this.startCount=0}load(t){if(t){void 0!==t.autoPlay&&(this.autoPlay=t.autoPlay);if(void
    0!==t.size){this.size||(this.size=new EmitterSize);this.size.load(t.size)}void 0!==t.direction&&(this.direction=t.direction);this.domId=t.domId;void 0!==t.fill&&(this.fill=t.fill);this.life.load(t.life);this.name=t.name;this.particles=e(t.particles,(t=>s({},t)));this.rate.load(t.rate);void
    0!==t.shape&&(this.shape=t.shape);if(void 0!==t.position){this.position={};void 0!==t.position.x&&(this.position.x=i(t.position.x));void 0!==t.position.y&&(this.position.y=i(t.position.y))}if(void 0!==t.spawnColor){void 0===this.spawnColor&&(this.spawnColor=new
    n);this.spawnColor.load(t.spawnColor)}void 0!==t.startCount&&(this.startCount=t.startCount)}}}class EmitterInstance{constructor(t,i,e,n,a){var r,h,l,d,c,u,m;var p;this.emitters=i;this.container=e;this._engine=t;this._currentDuration=0;this._currentEmitDelay=0;this._currentSpawnDelay=0;this._initialPosition=a;if(n
    instanceof Emitter)this.options=n;else{this.options=new Emitter;this.options.load(n)}this._spawnDelay=1e3*(null!==(r=this.options.life.delay)&&void 0!==r?r:0)/this.container.retina.reduceFactor;this.position=null!==(h=this._initialPosition)&&void
    0!==h?h:this.calcPosition();this.name=this.options.name;this._shape=null===(l=this._engine.emitterShapeManager)||void 0===l?void 0:l.getShape(this.options.shape);this.fill=this.options.fill;this._firstSpawn=!this.options.life.wait;this._startParticlesAdded=false;let
    v=s({},this.options.particles);null!==v&&void 0!==v?v:v={};null!==(d=v.move)&&void 0!==d?d:v.move={};null!==(c=(p=v.move).direction)&&void 0!==c?c:p.direction=this.options.direction;this.options.spawnColor&&(this.spawnColor=o(this.options.spawnColor));this._paused=!this.options.autoPlay;this._particlesOptions=v;this.size=null!==(u=this.options.size)&&void
    0!==u?u:(()=>{const t=new EmitterSize;t.load({height:0,mode:"percent",width:0});return t})();this._lifeCount=null!==(m=this.options.life.count)&&void 0!==m?m:-1;this._immortal=this._lifeCount
    <=0;this._engine.dispatchEvent( "emitterCreated",{container:e,data:{emitter:this}});this.play()}externalPause(){this._paused=true;this.pause()}externalPlay(){this._paused=false;this.play()}getPosition(){if(this.options.domId){const
        t=this.container,i=document.getElementById(this.options.domId);if(i){const e=i.getBoundingClientRect();return{x:(e.x+e.width/2)*t.retina.pixelRatio,y:(e.y+e.height/2)*t.retina.pixelRatio}}}return this.position}getSize(){const t=this.container;if(this.options.domId){const
        i=document.getElementById(this.options.domId);if(i){const e=i.getBoundingClientRect();return{width:e.width*t.retina.pixelRatio,height:e.height*t.retina.pixelRatio}}}return{width: "percent"===this.size.mode?t.canvas.size.width*this.size.width/100:this.size.width,height:
        "percent"===this.size.mode?t.canvas.size.height*this.size.height/100:this.size.height}}pause(){this._paused||delete this._emitDelay}play(){var t;if(!this._paused&&this.container.retina.reduceFactor&&(this._lifeCount>0||this._immortal||!this.options.life.count)&&(this._firstSpawn||this._currentSpawnDelay>=(null!==(t=this._spawnDelay)&&void 0!==t?t:0))){if(void 0===this._emitDelay){const t=a(this.options.rate.delay);this._emitDelay=1e3*t/this.container.retina.reduceFactor}(this._lifeCount>0||this._immortal)&&this.prepareToDie()}}resize(){const
        t=this._initialPosition;this.position=t&&r(t,this.container.canvas.size,h.origin)?t:this.calcPosition()}update(t){var i,e,s;if(!this._paused){if(this._firstSpawn){this._firstSpawn=false;this._currentSpawnDelay=null!==(i=this._spawnDelay)&&void
        0!==i?i:0;this._currentEmitDelay=null!==(e=this._emitDelay)&&void 0!==e?e:0}if(!this._startParticlesAdded){this._startParticlesAdded=true;this.emitParticles(this.options.startCount)}if(void 0!==this._duration){this._currentDuration+=t.value;if(this._currentDuration>=this._duration){this.pause();void
        0!==this._spawnDelay&&delete this._spawnDelay;this._immortal||this._lifeCount--;if(this._lifeCount>0||this._immortal){this.position=this.calcPosition();this._spawnDelay=1e3*(null!==(s=this.options.life.delay)&&void 0!==s?s:0)/this.container.retina.reduceFactor}else
        this.destroy();this._currentDuration-=this._duration;delete this._duration}}if(void 0!==this._spawnDelay){this._currentSpawnDelay+=t.value;if(this._currentSpawnDelay>=this._spawnDelay){this._engine.dispatchEvent("emitterPlay",{container:this.container});this.play();this._currentSpawnDelay-=this._currentSpawnDelay;delete
        this._spawnDelay}}if(void 0!==this._emitDelay){this._currentEmitDelay+=t.value;if(this._currentEmitDelay>=this._emitDelay){this.emit();this._currentEmitDelay-=this._emitDelay}}}}calcPosition(){return l({size:this.container.canvas.size,position:this.options.position})}destroy(){this.emitters.removeEmitter(this);this._engine.dispatchEvent("emitterDestroyed",{container:this.container,data:{emitter:this}})}emit(){if(this._paused)return;const
        t=a(this.options.rate.quantity);this.emitParticles(t)}emitParticles(t){var i,e,n;const o=this.getPosition(),a=this.getSize(),r=d(this._particlesOptions);for(let h=0;h
        <t;h++){const t=s({},r);if(this.spawnColor){const e=null===(i=this.options.spawnColor)||void
            0===i?void 0:i.animation;if(e){this.spawnColor.h=this.setColorAnimation(e.h,this.spawnColor.h,360);this.spawnColor.s=this.setColorAnimation(e.s,this.spawnColor.s,100);this.spawnColor.l=this.setColorAnimation(e.l,this.spawnColor.l,100)}t.color?t.color.value=this.spawnColor:t.color={value:this.spawnColor}}if(!o)return;const
            h=null!==(n=null===(e=this._shape)||void 0===e?void 0:e.randomPosition(o,a,this.fill))&&void 0!==n?n:o;this.container.particles.addParticle(h,t)}}prepareToDie(){var t;if(this._paused)return;const i=null===(t=this.options.life)||void 0===t?void
            0:t.duration;this.container.retina.reduceFactor&&(this._lifeCount>0||this._immortal)&&void 0!==i&&i>0&&(this._duration=1e3*i)}setColorAnimation(t,i,e){var s;const n=this.container;if(!t.enable)return i;const o=c(t.offset),r=a(this.options.rate.delay),h=1e3*r/n.retina.reduceFactor,l=a(null!==(s=t.speed)&&void
            0!==s?s:0);return(i+l*n.fpsLimit/h+3.6*o)%e}}class Emitters{constructor(t,i){this.container=i;this._engine=t;this.array=[];this.emitters=[];this.interactivityEmitters={random:{count:1,enable:false},value:[]};i.getEmitter=t=>void 0===t||"number"===typeof
            t?this.array[t||0]:this.array.find((i=>i.name===t));i.addEmitter=(t,i)=>this.addEmitter(t,i);i.removeEmitter=t=>{const e=i.getEmitter(t);e&&this.removeEmitter(e)};i.playEmitter=t=>{const e=i.getEmitter(t);e&&e.externalPlay()};i.pauseEmitter=t=>{const
            e=i.getEmitter(t);e&&e.externalPause()}}addEmitter(t,i){const e=new Emitter;e.load(t);const s=new EmitterInstance(this._engine,this,this.container,e,i);this.array.push(s);return s}handleClickMode(t){const i=this.emitters,s=this.interactivityEmitters;if("emitter"!==t)return;let
            n;if(s&&s.value instanceof Array)if(s.value.length>0&&s.random.enable){n=[];const t=[];for(let i=0;i
            <s.random.count;i++){const e=u(s.value);if(t.includes(e)&&t.length<s.value.length)i--;else{t.push(e);n.push(m(s.value,e))}}}else n=s.value;else
                n=null===s||void 0===s?void 0:s.value;const o=null!==n&&void 0!==n?n:i,a=this.container.interactivity.mouse.clickPosition;e(o,(t=>{this.addEmitter(t,a)}))}async init(){this.emitters=this.container.actualOptions.emitters;this.interactivityEmitters=this.container.actualOptions.interactivity.modes.emitters;if(this.emitters)if(this.emitters instanceof Array)for(const t of
                this.emitters)this.addEmitter(t);else this.addEmitter(this.emitters)}pause(){for(const t of this.array)t.pause()}play(){for(const t of this.array)t.play()}removeEmitter(t){const i=this.array.indexOf(t);i>=0&&this.array.splice(i,1)}resize(){for(const
                t of this.array)t.resize()}stop(){this.array=[]}update(t){for(const i of this.array)i.update(t)}}const v=new Map;class ShapeManager{constructor(t){this._engine=t}addShape(t,i){this.getShape(t)||v.set(t,i)}getShape(t){return v.get(t)}getSupportedShapes(){return
                v.keys()}}function randomSquareCoordinate(i,e){return i+e*(t()-.5)}class SquareShape{randomPosition(i,e,s){if(s)return{x:randomSquareCoordinate(i.x,e.width),y:randomSquareCoordinate(i.y,e.height)};{const s=e.width/2,n=e.height/2,o=Math.floor(4*t()),a=2*(t()-.5);switch(o){case
                0:return{x:i.x+a*s,y:i.y-n};case 1:return{x:i.x-s,y:i.y+a*n};case 2:return{x:i.x+a*s,y:i.y+n};case 3:default:return{x:i.x+s,y:i.y+a*n}}}}}class EmittersPlugin{constructor(t){this._engine=t;this.id="emitters"}getPlugin(t){return new Emitters(this._engine,t)}loadOptions(t,i){var
                s,n,o,a,r,h;if(!this.needsPlugin(t)&&!this.needsPlugin(i))return;(null===i||void 0===i?void 0:i.emitters)&&(t.emitters=e(i.emitters,(t=>{const i=new Emitter;i.load(t);return i})));const l=null===(n=null===(s=null===i||void 0===i?void 0:i.interactivity)||void
                0===s?void 0:s.modes)||void 0===n?void 0:n.emitters;if(l)if(l instanceof Array)t.interactivity.modes.emitters={random:{count:1,enable:true},value:l.map((t=>{const i=new Emitter;i.load(t);return i}))};else{const i=l;if(void 0!==i.value)if(i.value
                instanceof Array)t.interactivity.modes.emitters={random:{count:null!==(o=i.random.count)&&void 0!==o?o:1,enable:null!==(a=i.random.enable)&&void 0!==a&&a},value:i.value.map((t=>{const i=new Emitter;i.load(t);return i}))};else{const e=new
                Emitter;e.load(i.value);t.interactivity.modes.emitters={random:{count:null!==(r=i.random.count)&&void 0!==r?r:1,enable:null!==(h=i.random.enable)&&void 0!==h&&h},value:e}}else{const i=t.interactivity.modes.emitters={random:{count:1,enable:false},value:new
                Emitter};i.value.load(l)}}}needsPlugin(t){var i,e,s;if(!t)return false;const n=t.emitters;return n instanceof Array&&!!n.length||void 0!==n||!!(null===(s=null===(e=null===(i=t.interactivity)||void 0===i?void 0:i.events)||void 0===e?void
                0:e.onClick)||void 0===s?void 0:s.mode)&&p("emitter",t.interactivity.events.onClick.mode)}}async function loadEmittersPlugin(t){t.emitterShapeManager||(t.emitterShapeManager=new ShapeManager(t));t.addEmitterShape||(t.addEmitterShape=(i,e)=>{var
                s;null===(s=t.emitterShapeManager)||void 0===s?void 0:s.addShape(i,e)});const i=new EmittersPlugin(t);await t.addPlugin(i);t.addEmitterShape("circle",new CircleShape);t.addEmitterShape("square",new SquareShape)}export{loadEmittersPlugin};
                //# sourceMappingURL=index.js.map